---
import Base from "/Users/bennett/my-portfolio/src/layouts/BaseLayout.astro";
import Header from "/Users/bennett/my-portfolio/src/components/Header.astro";
import Footer from "/Users/bennett/my-portfolio/src/components/Footer.astro";
import { getCollection, getEntry } from "astro:content";

const { slug } = Astro.params;

// Support either `/projects/foo` or nested like `/projects/2025/foo`
const parts = Array.isArray(slug) ? slug : [slug];
const entrySlug = parts[parts.length - 1];

// Fetch the entry by slug
const all = await getCollection("projects");
const entry = all.find((e) => e.slug === entrySlug);
if (!entry) {
  throw new Error(`Project not found: ${entrySlug}`);
}

const { Content, data } = await getEntry(entry.collection, entry.slug);
const title = data.title;
const description = data.description;
---

<Base title={title} description={description}>
  <Fragment slot="header"><Header /></Fragment>

  <article class="prose prose-invert:max-w-none">
    <header class="mb-6">
      <h1 class="text-3xl font-bold">{title}</h1>
      <p class="text-muted">{description}</p>
      <p class="mt-2 text-sm text-muted">
        <strong>{data.year}</strong> · {data.tags?.join(" • ")}
      </p>
      <p class="mt-2 flex gap-4">
        {data.repo && <a class="underline decoration-dotted" href={data.repo}>Repo</a>}
        {data.demo && <a class="underline decoration-dotted" href={data.demo}>Live</a>}
      </p>
    </header>

    <Content />
  </article>

  <Fragment slot="footer"><Footer /></Fragment>
</Base>